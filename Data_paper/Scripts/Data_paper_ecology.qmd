---
title: Bird diversity in working landscapes of Colombia 
subtitle: Data paper
date: last-modified
bibliography: ../PhD.bib
# If you do not want code to show... echo: false
execute: 
 echo: false
 #include: false
 message: false
 warning: false 
metadata-files: 
  - ../authors.yml
  - ../abstract_keywords.yml
format: 
  elsevier-pdf:
    include-in-header:
      text: |
       \usepackage{makecell}
       \usepackage{lineno}
       \linenumbers
       \usepackage[margin=1in]{geometry}
       \setlength{\LTleft}{\fill}
       \setlength{\LTright}{\fill}
    journal:
      name: Journal Name
      formatting: preprint
      cite-style: authoryear
editor: visual 
editor_options: 
  chunk_output_type: console
---

# Outline

```{r}
#| label: Load-libraries

library(readxl)
library(tidyverse)
library(hms)
library(sf)
library(units)
library(cowplot)
library(png)
library(grid)
library(kableExtra)
```

```{r}
#| label: Load-data-and-fns

# Load in data 
Pc_locs_sf <- st_read("Derived_geospatial/shp/Pc_locs.gpkg", quiet = TRUE)

path <- "Data_paper/DataS1"
File_names <- list.files(path)

Data <- map(File_names, \(sheet){
  read_csv(file = paste0(path, "/", sheet))
})
names(Data) <- str_remove(File_names, ".csv")

Data$Functional_traits <- Data$Functional_traits %>% select(-Match_type) 

# Load functions
source("/Users/aaronskinner/Library/CloudStorage/OneDrive-UBC/Grad_School/Rcookbook/Themes_funs.R")
```

```{r}
#| label: insert-num-objs

Num_obs <- nrow(Data$Bird_pcs_all)
Num_obs_prty <- prettyNum(Num_obs, big.mark = ",")
Num_sites <- nrow(Data$Site_covs)
Num_spp <- length(unique(Data$Bird_pcs_analysis$Species_ayerbe))
Num_fam <- length(unique(Data$Taxonomy$Family_gbif))
Tot_pc <- nrow(Data$Event_covs)
Tot_pc_prty <- prettyNum(Tot_pc, big.mark = ",")
Num_ft <- Data$Functional_traits %>% 
  select(-c(Species_ayerbe, Source, Source_elev)) %>% 
  ncol()
Num_farms <- unique(Data$Site_covs$Id_gcs) %>% length()

# Point counts were sampled 1–15 times, with [CREATE] 74% of locations visited 3 times within a closed sampling period
Per_1_visit <- 128 / Num_sites # Cipav points / all points 
Per_3_visits <- (1 - Per_1_visit) * 100
```

## Format of document

I've included the broad categories from the Ecology template, the associated short description, and then my suggested response, as in the following example:

## Example category

Description provided by Ecology

My suggested response

# Introduction

Agriculture dominates half of the world’s land mass, and has resulted in extensive forest destruction, fragmentation, and the endangerment of biodiversity [@kennedyManagingMiddleShift2019; @lewisIncreasingHumanDominance2015; @hald-mortensenMainDriversBiodiversity2023]. One way of ameliorating agriculture’s impact on earth’s natural systems is through ecological intensification, which combines traditional ecological knowledge with scientific innovation to reduce external inputs, improve/maintain productivity, and conserve agrobiodiversity [@altieriLinkingEcologistsTraditional2004; @kremenEcologicalIntensificationDiversification2020; @kremenDiversifiedFarmingSystems2012]. A swift transition to diversified agricultural systems is particularly important in the hyper-biodiverse Neotropics (i.e. new-world tropics), where biodiversity is plummeting faster than anywhere in the world, and agriculture is the primary threat [@almondLivingPlanetReport2022; @antonelliRiseFallNeotropical2022]. Monoculture grass pasture, in particular, is the dominant anthropogenic land cover in the Neotropics [@faoFAOSTAT2020]; thus, management of pastoral lands will determine the fate of much of tropical biodiversity [@calleStrategyScalingUpIntensive2013; @murgueitioNativeTreesShrubs2011; @mendenhallCountrysideBiogeography2013].

Implementing silvopastoral systems – an agroforestry technique involving the incorporation of productive trees and shrubs in pastoral landscapes – on lands previously converted to grass pasture may play an important role in slowing biodiversity declines. Indeed, by adding botanical and structural diversity to the landscape it is thought that silvopasture may positively impact biodiversity by facilitating dispersal [@kremenLandscapesThatWork2018], buffering species from the negative effects of fragmentation [@arroyo-rodriguezDoesForestFragmentation2017; @ewersFragmentationImpairsMicroclimate2013], and ultimately increasing species persistence in fragmented landscapes. Colombia offers a salient example within the Neotropics of a country with extremely high levels of biodiversity that are gravely threatened by agriculture [@murciaConservingBiodiversityComplex2013; @etterRegionalPatternsAgricultural2006]. Pastureland (and feed crops for cattle) have a particularly large impact as the predominant anthropogenic land use in the country, occupying \~30% of the country’s landcover [@vanausdalPastureProfitPower2009; @lernerSustainableCattleRanching2017]. Over the past several decades, various organizations in Colombia have implemented projects to introduce silvopasture as one method for rehabilitating the substantial areas of degraded pastures in Colombia. Implementation of silvopasture will also be critical in meeting sustainability, production, climate, and conservation goals [@tapascoLivestockSectorColombia2019; @fedeganCifrasReferenciaSector2018].

Bird communities are structured by a mix of local and landscape level processes. The local management of agroecosystems is important as this greatly influences resource and niche space availability, predominantly through the vegetative cover and structural diversity. For example, agrobiodiversity can range from homogenous monocultures to highly diversified polycultures, management can be minimally or highly disruptive (e.g., mowing, tilling, harvesting), and pests can be controlled by leveraging ecosystem services or through the application of toxic pesticides [@stantonAnalysisTrendsAgricultural2018]. Past work in silvopastoral systems has found greater taxonomic diversity compared to monoculture pasture, but less than forested habitat [@mendozaConsistencyBirdUse2014; @auspreySensitivityTropicalMontane2023], although there are exceptions reporting equivalent or higher levels of diversity in silvopasture relative to forest patches [@broomSustainableEfficientLivestock2013; @prevedelloImportanceScatteredTrees2018]. Furthermore, the impact of local management is likely moderated by climatic conditions like temperature and rainfall, as bird affiliation with agricultural systems tends to be greater in cooler / wetter environments [@frishkoffClimateChangeHabitat2016; @boyleHygricNichesTropical2020; @soberonGrinnellianEltonianNiches2007]. Given these complexities, our understanding of silvopasture's impact on bird biodiversity is limited by studies with small spatiotemporal and taxonomic coverage.

Here we present the 'Bird diversity in working landscapes of Colombia' dataset, collating and standardizing data across `r Tot_pc_prty` surveys at `r Num_sites` unique point count locations from 2013 - 2024. We recorded `r Num_obs_prty` bird observations of `r Num_spp` species in `r Num_fam` families across five distinct ecoregions, including tropical dry forest, Andean montane forest, and the plains of the Orinoco river basin (@fig-sampling-map). The most speciose orders were Passeriformes, Apodiformes, Piciformes, Psittaciformes, and Accipitriformes (@fig-phylogeny), and the species that were both widespread and abundant tended to thrive in highly dynamic and heterogeneous landscapes (e.g., *Tyrannus melancholicus, Cyanocorax violaceus, Bubulcus ibis, Milvago chimachima,* and *Crotophaga ani*; @fig-abund-widespread-spp).

![The locations of 496 point count sites in 73 farms across five ecoregions in Colombia. Colombia is extremely topographically diverse, with the Andes mountain range trifurcating into three distinct 'cordilleras', in addition to smaller 'sierras' (e.g., Sierra Nevada de Santa Marta) that are critical for understanding bird distributions in Colombia. In between the cordilleras lie two major river valleys, the Cauca and Magdalena (labeled in red). Major rivers also run off the Eastern slope of the Andes into the plains and eventually into the Amazon. The shape of the symbol corresponds to the data collector, and the size corresponds to the number of point counts within a quarter degree squared grid cell. Note that a small jitter was applied to all points, and a larger jitter was applied to points in the Piedemonte region to improve visibility. Elevation was log-transformed to emphasize altitudinal gradients at lower elevations.\
\
COLLABORATORS: Does anyone have a shapefile of the rio Cesar? Also, is it correct that the unlabed river in the northeast is the Catatumbo River?](../Figures/Map_sampling/TNC_Field_Map_Final.png){#fig-sampling-map}

The `r Tot_pc_prty` point count surveys were sampled 1–15 times total, with `r round(Per_3_visits, 0)`% of locations visited $\geq$ 3 times within a closed sampling period, enabling estimation of detection probabilities through hierarchical models. Land-use landcover types surveyed include mature forest, forest fragments, riparian forest, crops, intensive pasture, several types of silvopasture, and heterogeneous mosaics (i.e., no single dominant landcover type). This dataset permits analyses of bird diversity patterns and community composition across land-use gradients, especially the effects of silvopastoral practices on biodiversity in tropical working landscapes. We also provide complementary datasets of taxonomic equivalents (BirdLife, BirdTree, and eBird / Clements), functional traits, site covariates, and survey covariates (@tbl-file-info), facilitating a variety of research questions and analytical approaches. For example, one could examine the interacting effects of local management practices and climate, while controlling for phylogenetic non-independence, to understand silvopasture's influence on functional diversity and ecosystem service provisioning. Importantly, the longitudinal nature of these data allow for analyses of population trends or colonization/extinction dynamics, which is critical for conservation practitioners [@leesRoadmapIdentifyingFilling2020].

![Phylogenetic relationships of 568 species observed in our data set. There were 24 orders, of which 17 are shown using grayscale representative species (downloaded from phylopic). The number of species in each order is listed in parentheses.](../Figures/Phylogeny_equal_sizes.png){#fig-phylogeny}

```{r}
#| label: tbl-file-info
#| tbl-cap: File names, number of observations per .csv file, and their size in megabytes. 

# Specify the path to the directory
directory_path <- "Data_paper/DataS1" # Replace with your actual directory path

# Get information about all files and extract the size of each file
file_info <- file.info(list.files(path = directory_path, full.names = TRUE))
file_sizes <- file_info$size

# Short descriptions of each file 
Short_descriptions <- tibble(
  File_name = c("Bird_pcs_all.csv", "Bird_pcs_analysis.csv", "Event_covs.csv", "Functional_traits.csv", "Site_covs.csv", "Taxonomy.csv"),
  Description =  c("All point count observations", "Subset of ‘Bird_pcs_all.csv’ (see 'Data_filtering_analysis.R')", "Information about each survey, including date, start time, and detection covariates", "Functional traits of all species observed in the project", "Unchanging covariates of each point count location", "Taxonomic equivalents including BirdLife, BirdTree, and eBird/Clements")
)

# Number of observations in each data set
Num_obs_vec <- map_chr(Data, \(df){
  nrow(df) %>% base::prettyNum(big.mark = ",")
})

# Combine in tibble 
file_names_and_sizes <- tibble(
  File_name = basename(rownames(file_info)),
  Number_obs = Num_obs_vec,
  Size_MB = round(file_sizes / 1e6, 2)
) %>% full_join(Short_descriptions) %>%
  arrange(desc(Size_MB)) %>% 
  relocate(Description, .after = File_name)

# To do - I want to 1) align the contents each column underneath the center of the column header, and 2) in header "Number \nobservations" the "\nobservations" part is not being printed on a second line. How can I fix? 
# Print and format
file_names_and_sizes %>% 
  rename_with(~c("File name", "Description", "Number \nobservations", "Size (MB)")) %>%
  kable("latex", booktabs = TRUE, longtable = TRUE) %>%
  kable_styling(latex_options = c("striped", "hold_position"), 
                position = "center") %>% 
    column_spec(2, width = "8cm")
```

![The most abundant and widespread bird species in the project (before filtering species). The total count refers to the summed count across all surveys, and localities refers to the number of unique point count locations where the species was detected at least once (total = 496).](../Figures/Species_counts_localities.png){#fig-abund-widespread-spp}

# Class I. Data Set Descriptors

## A. Data set identity:

Title or theme of data set

Bird diversity in working landscapes of Colombia

## B. Data set identification code:

Database accession numbers or site-specific codes used to uniquely identify data set\
\
Bird_pcs_all.csv

## C. Data set description

### Originators:

Names and address of principal investigators associated with data set

CMK - Tomas & Diego Lizcano?

### D. Key words/phrases:

Location (spatial scale), time period and sampling frequency (temporal scale), theme or contents (thematic scale)

Colombia, Bajo Magdalena, Ecorregion Cafetera, Valle del rio Cesar, Piedemonte, Boyacá & Santander, 2013 - 2024, longitudinal data

# Class II. Research origin descriptors

## A. Overall project description:

*\[Note: This section may be essential if data set represents a component of a larger or more comprehensive database; otherwise, relevant items may be incorporated into II.B.\]*

1.  Identity: This data set was been collected during two long-term international initiatives, the Sustainable Cattle Ranching (SCR) and the Science for Nature and People Partnership (SNAPP) projects.

2.  Originators: Names and addresses of principal investigators associated with project\
    \[Tomas Walschburger, Manuel Gómez Vivas, Christina Kennedy, Juliana Delgado\]\
    COLLABORATORS - Provide address

3.  Period of study: Date commenced, date terminated, or expected duration\
    \[2013-2025\]

4.  Objectives: Scope and purpose of research program\
    \
    The SCR project (2012-2019) and the subsequent SNAPP project (2022 - 2025) monitored biodiversity, carbon, farm productivity, and the socioeconomic status of farmers that adopted silvopasture in Colombia. The specific objectives were to: 1) Understand the impacts of silvopasture system (SPS) practices for biodiversity, climate, productivity, and farmer wellbeing; 2) Identify conditions for synergies (win-win situations) for people and nature; 3) Evaluate real-world drivers of on-farm adoption and better understand enablers and constraints; 4) Develop evidence-based guidance for environmental certification standards and advance a diagnostic tool for sustainable cattle ranching partners.

5.  Abstract: Descriptive abstract summarizing broader scientific scope of overall research project\
    \
    By 2050, global demands for livestock products (milk and meat) are estimated to increase by more than 50%, and correspondingly, cattle production in Latin America could increase by 125%. How this growth occurs has significant social, economic, and environmental consequences. Extensive pasture monoculture is the dominant livestock grazing system in Latin America and is environmentally damaging and vulnerable to climate change. It has led to habitat conversion, biodiversity loss, degraded soils and water quality, and increased greenhouse gas emissions. Silvopastoral Systems – the intentional incorporation of trees and shrubs in grazing lands – are a promising alternative to reduce the environmental footprint of pasture monocultures and enhance productivity and climate benefits to farmers and society. With the aim of understanding silvopasture’s impacts on multifunctional outcomes including biodiversity, carbon, farm productivity, and the socioeconomic status of farmers, the SCR and SNAPP projects worked on 4,100 farms across five ecoregions of Colombia from 2012-2025. Through technical assistance and provision of materials, the project transformed \~160,000 hectares of degraded pasture to silvopasture, primarily by integrating live fences and dispersed trees. Preliminary analyses show the potential for win-win outcomes for people and nature. However, silvopasture has rarely been adopted outside of international development projects, and its potential for scaling is poorly understood.

6.  Sources of funding: Grant and contract numbers, names, and addresses of funding sources\
    \
    COLLABORATORS - Please provide

## B. Specific subproject description

### Site description

-   Site type: Descriptive (e.g., short-grass prairie, blackwater stream, etc.)\
    \
    Sampling was conducted in five broad ecoregions: The coffee region, Boyacá and Santander, Piedemonte, Bajo Magdalena, and el Rio Cesar (@fig-sampling-map). Colombia is a tropical country with extreme topographic complexity but little temperature variation throughout the year. Thus, climate and seasonality are primarily defined by elevation and rainfall patterns (@fig-envi-boxplots). Rainfall is unimodal closer to the equator (e.g., our sites in the Piedemonte region are closer to unimodal) and generally bimodal further from the equator (@fig-prec-smooth), although local topography complicates these patterns.

![Elevation, average temperature, and average precipitation of each point count location within five ecoregions. Note that elevation and average yearly temperature are almost perfectly inversely correlated in our data. A jitter was applied to aid in visualization.](../Figures/Envi_vars.png){#fig-envi-boxplots}

[The Andes:]{.underline} The coffee region and Boyacá and Santander reside in the Andes, a region defined by complex topography, highly regional microclimates, and extreme elevational and climatic gradients over short horizontal distances. The Andes trifurcate into three distinct 'cordilleras' and two major intermontane valleys, the Cauca Valley between the Western and Central cordilleras, and the Magdalena valley between the Central and Western Andes. The eastern slopes of the cordilleras tend to be wetter than the western slopes (although the western side of the westernmost cordillera is an exception due to its proximity to the Choco), and there are small rain shadows at lower elevations in the valley floors. Topographic complexity and highly regional microclimates have resulted in high bird diversity, including a large influx of migrants in the winter months. Note that our sites in the coffee region span both the Magdalena and Cauca river valleys, as well as the Western and Central cordilleras, whereas our sites in Boyacá and Santander are only in the Eastern cordillera.\
[Piedemonte:]{.underline} On the East side of the Eastern-most chain of the Andes is the 'Piedemonte' (foothills) region, a complex transition zone between the Andes and the flat plains (i.e. los Llanos) to the East. Heavy rainfall on the Eastern slope of the Andes results in many rivers and gallery forests dissecting the landscape as they flow East towards the plains and south towards Amazonia. Little forest remains and cattle ranching is the predominant agricultural activity of the region. The birds of the Piedemonte are quite diverse as it is a mix of Andean and Llanos birds, with some widespread Amazonian birds reaching our sampling sites.\
[Bajo Magdalena:]{.underline} This region is where the Magdalena river flattens out and empties into the Caribbean ocean. The region is dry although it gets wetter further inland. Coastal regions are largely windswept, dominated by short stature tropical dry forest (most trees drop their leaves) and desert-like scrub. [\
Rio Cesar:]{.underline} A dry river valley nestled between the imposing Sierra Nevada de Santa Marta (the tallest coastal mountain range in the range) and the Serranía del Perijá mountains that straddle the Colombia-Venezuela border. The vegetation is similar to the Bajo Magdalena region. High temperatures and low precipitation result in desert conditions, with scrubby acacia-like trees and large cacti dominating the vegetation. This unique region has relatively high endemism, sharing birds only with similar desert areas in neighboring Venezuela.\
\
\[COLLABORATORS\]: I never visited the sites in Rio Cesar or Bajo magdalena, so I'm unsure exactly what I should highlight to differentiate our sampling sites in these regions. Also, I've combined the treatment of the coffee region and Boyacá and Santander for now, as both of these regions are defined by the Andes. I'm open to other suggestions though.

![In Colombia, precipitation is one of the primary determinants of the distribution of biodiversity. Rainfall is bimodal throughout most of Colombia, although often becomes unimodal closer to the equator. Curves show the 30-year average precipitation at our sampling sites, grouped by ecoregion. Curves were fit using generalized additive model smoothers fit separately by ecoregion, with a cyclic cubic regression spline and basis dimension k = 12 to capture monthly periodicity.](../Figures/Rainfall/Prec_smoothed.png){#fig-prec-smooth width="700"}

-   Geography: Location (e.g., latitude/longitude), size

```{r}
#| label: Geo-extent

Pc_locs_sf %>% st_bbox() 
```

```{r}
#| label: mcp-study-area

# Custom function to convert to mcp & calculate area
calc_km2 <- function(sf_obj, group = NULL) {
  group <- rlang::enquo(group)

  if (rlang::quo_is_null(group)) {
    sf_obj <- sf_obj %>% mutate(group = "All")
    group <- rlang::sym("group")
  }

  sf_obj %>%
    group_by( {{ group }} ) %>%
    summarise(geometry = st_union(geom), .groups = "drop") %>%
    st_convex_hull() %>%
    st_transform(crs = st_crs("EPSG:32618")) %>%
    mutate(Area = set_units(st_area(.), km^2) |> drop_units()) %>%
    st_drop_geometry() %>% 
    mutate(Area = round(Area, 0))
}
?st_convex_hull
# Study area
area_km2_all <- calc_km2(Pc_locs_sf) # Total
area_km2_ecor <- calc_km2(Pc_locs_sf, group = Ecoregion) # By ecoregion
```

```{r}
#| label: tbl-elev
#| tbl-cap: Minimum and maximum elevations (m), the elevational range (m), and the area (km²) of bird sampling locations in each ecoregion.

Data$Site_covs %>% 
  summarize(Min = min(Elev, na.rm = TRUE),
            Max = max(Elev, na.rm = TRUE), 
            Range = Max - Min,
            .by = Ecoregion) %>% 
  left_join(area_km2_ecor) %>%
  arrange(Range) %>%
  kable("latex", booktabs = TRUE, longtable = TRUE, escape = FALSE, align = "c") %>%
  kable_styling(latex_options = c("striped", "hold_position"),
                position = "center")
```

Our study area covered nearly 8$^{\circ}$ of latitude, 3.5$^{\circ}$ of longitude, and `r area_km2_all$Area` $\text{km}^2$. See @tbl-elev for the area (the convex hull) of bird sampling locations in each ecoregion.

Habitat: Detailed characteristics of habitats sampled

```{r}
#| label: Hab-tbls

Create_hab_tbl <- function(col){
  Data$Site_covs %>% 
  distinct(Id_muestreo_no_dc, {{ col }}) %>%
  count( {{ col }}) %>%
  pivot_wider(names_from = {{ col }}, values_from = n) %>% 
  Cap_snake()
}

Hab_tbl <- Create_hab_tbl(col = Habitat)
Hab_sub_tbl <- Create_hab_tbl(col = Habitat_sub)

#Pc_hab %>% filter(Habitat_sub == "Maduro")
```

`r Tot_pc_prty` point counts were conducted in five primary habitats (e.g. forest) and eight sub-habitat types (e.g., riparian forest). After each primary habitat or sub-habitat type we list the number of unique point count locations (n):

-   Forest (Total n = `r Hab_tbl$Bosque` point counts)

    -   Forest fragments (n = `r Hab_sub_tbl$Secundario`): Small fragments embedded in cattle ranching landscapes. Forest fragments were generally \< 5 ha, although many were connected to other forested elements in the landscape. Surveys were conducted on the forest edge, either inside the forest (\<50 m from the edge) or just outside the forest (\<15 m outside the forest), although this was not recorded systematically.

    -   Riparian forest (n = `r Hab_sub_tbl$Ripario`): Gallery forests on either side of a stream or river

    -   Mature forest (n = `r Hab_sub_tbl$Maduro`): Taller, older, and larger contiguous forests. 10 of these points were in the Ecorregion Cafetera (9 in the ecological reserve Otún Quimbaya, 1 in Reserva El Hatico) and 2 were in a large intact forest in the Piedemonte.

    -   \[COLLABORATORS\]: How do we want to define 'mature' forest? In the 'Habitat_sub' column I set everything to 'Secondary' unless it was specified in the data that it was a riparian forest or a mature forest. However, there may be other forests surveyed that could be considered mature.

-   Silvopasture (Total n = `r Hab_tbl$Ssp`): Silvopastoral systems consist of a variety of practices and range across a spectrum regarding the diversity and intensity of practices implemented. For example, silvopastural systems can be tree (and grass) monocultures planted to be homogeneous in spacing and age, or, alternatively, they can be highly-productive, diverse polycultures composed of remnant vegetation and naturally recruited tree species [@cubbageComparingSilvopastoralSystems2012]. See @murgueitioNativeTreesShrubs2011, @calleStrategyScalingUpIntensive2013, and @cubbageComparingSilvopastoralSystems2012 to better understand the full extent of management practices that can be incorporated in silvopastoral systems. In our bird sampling efforts, the project differentiated between several types of silvopasture:

    -   Dispersed trees (n = `r Hab_sub_tbl$Arboles_dispersos`): Trees integrated directly into the pasture where cows graze, providing shade as well as direct forage in some cases

    -   Live fences (n = `r Hab_sub_tbl$Cerca_viva`): Linear rows of trees that serve to reduce wind and the drying of grass forage, as well as to divide paddocks.

    -   Shrub live fences (n = `r Hab_sub_tbl$Setos`): Linear rows of shrubs used to divide paddocks and provide direct forage for cattle.

    -   Multi-species fodder banks (n = `r Hab_sub_tbl$Banco_de_forraje`): Forage that is cut and transported to paddocks for consumption.

    -   Intensive SPS (n = `r Hab_sub_tbl$Intensivo`): Incorporation of several of the aforementioned practices, including high densities of fodder shrubs, a variety of native grasses for direct foraging by cattle, and tropical trees for timber or fruit.

-   Intensive pasture (n = `r Hab_tbl$Pastizales`): Monoculture cattle ranching systems that are generally hotter, drier, and more homogenous than the other habitat types surveyed.

-   Heterogeneous mosaics (n = `r Hab_tbl$Mosaic`): A mix of all other habitat types, particularly where there was no single dominant landcover type within the 50-m fixed radius.

-   Crops (n = `r Hab_tbl$Cultivos`): Other agricultural systems unrelated to rearing cattle.

![Example landscape on a cattle ranching farm surveyed in the Piedemonte Ecoregion. Red circles represent the location of 50-m radius point counts. Four common habitat types surveyed in the project are labeled.](../Figures/Example_landscape/Example_landscape.pdf)

-   Geology, landform: Soils, slope/elevation/aspect, terrain/physiography, geology/lithology

    At high elevations (Coffee region, Boyacá and Santander), steep slopes generate thin, rocky, volcanic soils that underlie deeply dissected river valleys. These steep slopes grade into rolling, soil-mantled landscapes in the foothills and into the alluvial lowlands of Bajo Magdalena and the Piedemonte. El Valle de Rio Cesar is characterized by thin, rocky, and often saline soils. Elevation and topography shape soil development as well as local climate and vegetation patterns.

-   Watersheds, hydrology: Size, boundaries, receiving streams, etc.

    See the 'Site type' section.

-   Site history: Site management practices, disturbance history, etc.\
    \
    Excluding the 'mature forest' sites, point counts were embedded in highly dynamic landscapes. Cattle ranching was the predominant agricultural activity on the farms we sampled, although other crops (e.g., palm oil, avocado, citrus, coffee) were found in some ecoregions. Most of the riparian forest and forest fragments were young (\<30 years old, although age varied among farms and regions), and the forests were often disturbed by humans (cutting for lumber, hunting, etc.). Fencing to prevent the intrusion of cattle into forests and streams was common on some farms / regions, and rare in others.

-   Climate: Descriptive summary of site climatic characteristics

    See previous sections, particularly the 'Site type' section.

### Experimental or sampling design:

a.  Design characteristics: Description of statistical/sampling design

    To understand silvopasture’s impact on avian biodiversity, various contractors (CIPAV, GAICA, and UniLlanos, as by their Spanish initials) conducted `r Tot_pc_prty` avian point counts at `r Num_sites` unique sites across agricultural intensity gradients on (or near) `r Num_farms` different farms across 12 geopolitical departments of Colombia. These 12 departments were grouped into 5 ecologically similar regions (hereafter, ‘ecoregions’; @fig-sampling-map, @tbl-by-data-set).

b.  Permanent plots: Dimension, location, general vegetation characteristics (if applicable).

```{r}
#| label: Prep-tbl-by-data-set

# Join covs
Site_covs <- Data$Site_covs[c("Id_muestreo_no_dc", "Id_gcs", "Habitat", "Ecoregion", "Departamento")]
Covs_join <- Data$Event_covs %>% 
  left_join(Site_covs) 

# Calculate duration for CIPAV 
Cipav_duration <- Covs_join %>% filter(Uniq_db == "Cipav mbd") %>%
  summarize(min_dur = min(Pc_length), 
            max_dur = max(Pc_length)) %>% 
  mutate(Duration = paste0("0 - ", max_dur / 60)) %>% 
  pull(Duration)
Duration_minutes <- c(Cipav_duration, rep("10", 5))
# Years sampled
Years_sampled <- Covs_join %>% 
  summarize(min_year = min(Ano),
            max_year = max(Ano), 
            .by = Uniq_db) %>% 
  mutate(Years_sampled = case_when(
    min_year != max_year ~ paste(min_year, "-", max_year), 
    min_year == max_year ~ as.character(max_year)
    )) %>% 
  pull(Years_sampled)

#  Calculate the number of ecoregions and departments
Ecoregions_departments <- Covs_join %>% 
  summarize(Num_depts = length(unique(Departamento)), 
            Num_ecor = length(unique(Ecoregion)),
            .by = Uniq_db) %>% 
  mutate(Ecoregions_departments = paste0(Num_ecor, " (", Num_depts, ")")) %>% 
  pull(Ecoregions_departments)

Data_set_tbl <- tibble(Uniq_db = unique(Covs_join$Uniq_db),
                       Years_sampled, 
                       Duration_minutes, 
                       Radius_m = c(25, rep(50, 5)), 
                       Ecoregions_departments)
Data_set_tbl_summ <- Covs_join %>%
  summarise(Point_counts = length(unique(Id_muestreo)),
            Farms = length(unique(Id_gcs)), 
            Habitats_surveyed = str_c(unique(Habitat), collapse = ", "),
            .by = Uniq_db)
```

```{r}
#| label: tbl-by-data-set
#| tbl-cap: The number of unique point count locations conducted by each contracting institution, as well as the methodology, the habitats surveyed, and the respective years they surveyed. Note that 'Ubc mbd' sampled the same 54 point count locations as 'Unillanos mbd', plus two additional points in a continuous patch of intact forest. 


Data_set_tbl %>% full_join(Data_set_tbl_summ) %>% 
  rename(Dataset = Uniq_db, 
         "Duration_(minutes)" = Duration_minutes,
         "Radius_(m)" = Radius_m, 
         "Ecoregions_(departments)" = Ecoregions_departments) %>% 
  rename_with(.cols = everything(), 
              .fn = ~linebreak(str_replace_all(., "_", "\n"),  align = "c")) %>% 
  kable("latex", booktabs = TRUE, longtable = TRUE, escape = FALSE, align = "c") %>%
  kable_styling(latex_options = c("striped", "hold_position"), #"scale_down"
                position = "center") #%>%
  #column_spec(5, width = "7.5cm")
```

a.  Data collection period, frequency, etc.: Information necessary to understand temporal sampling regime

    ```{r}
    #| label: Per-three-plus

    Max_pcs_per_season <- Data$Event_covs %>% 
      filter(Nombre_institucion != "Cipav") %>% 
      slice_max(order_by = Rep_season, by = Id_muestreo)
    Three_plus_reps <- Max_pcs_per_season %>% filter(Rep_season >= 3)
    Per_three_plus <- nrow(Three_plus_reps) / nrow(Max_pcs_per_season) * 100
    ```

    Point count locations were sampled in multiple closed sampling periods by the same data collector using (essentially) the same methodology in several ecoregions. For example, in the Ecorregion Cafetera, GAICA surveyed the same point count locations in June 2013, November 2016, and June 2024 (with guidance from UBC in 2024; @fig-temporal-sampling). No point count locations were sampled in more than three distinct sampling periods. AAS from the University of British Columbia (UBC) complemented these efforts in the summer of 2022 by resampling 54 point count locations that were sampled in 2019 in the Piedemonte ecoregion.

    Excluding the point counts conducted by CIPAV (which were surveyed only once), `r Per_three_plus`% of point count locations were sampled at least 3 times within a closed sampling period. Within a closed sampling period it is assumed that there are no births, deaths, immigration, or emigration, and thus the true (but latent) abundance does not change. Sampling 3 or more times in a closed sampling period allows for modeling detectability, and ultimately more robust estimates of occupancy and abundance [@mackenzieEstimatingSiteOccupancy2003].

![The temporal distribution of point count sampling across 5 ecoregions, where the shape of the points indicates unique point count locations within a given ecoregion. For example, in El Piedemonte GAICA resampled the same point count locations in October of 2016 and March of 2017 (depicted as crosses). Each point represents a date that point counts were sampled, with point count locations resampled across sampling periods in four ecoregions (Bajo Magdalena, Cafetera, Piedemonte, Rio Cesar). Note that contractors did not survey point count locations sampled by other contractors, with the exception of 54 point counts sampled in 2019 by UniLlanos and in 2022 by UBC (depicted as diamonds).](../Figures/Pc_month_year_day_ecoregion.png){#fig-temporal-sampling}

### Research methods

```{r}
#| label: Sampling-description

# The percent of point counts surveyed before 11 AM
Before_11 <- Data$Event_covs %>% 
  filter(Pc_start < as_hms("11:00:00")) %>% 
  nrow()
Per_bfor_11 <- round((Before_11 / nrow(Data$Event_covs)) * 100, 0)

# Number of point counts conducted in each region
Ecor_pc <- Data$Site_covs %>% 
  count(Ecoregion, sort = T)
Pc_piedemonte <- Ecor_pc %>% 
  filter(Ecoregion == "Piedemonte") %>% 
  pull(n)

Ecor_pc_no_pdm <- Ecor_pc %>% 
  filter(Ecoregion != "Piedemonte")
```

a.  Field/laboratory: Description or reference to standard field/laboratory methods\
    \
    In general, point counts were conducted for 10 minutes and with a 50-m fixed radius, although CIPAV employed a different methodology (25-m radius, variable amount of time; Table 1). Point counts were mostly conducted in the morning, between sunrise and 11 AM (`r Per_bfor_11`%), although some data collectors also surveyed in the afternoon. Data sets differ in the intensity with which farms were surveyed – some data sets contain fewer farms that were more heavily sampled (e.g., Unillanos mbd), whereas others surveyed many farms but with less sampling intensity (e.g., Cipav mbd; @fig-pc-farm-db). In all data sets except Cipav mbd, point count surveys were repeated on consecutive days which permits modeling of detectability (3 - 5 repeat surveys at each point count; @fig-pc-farm-db), although only Ubc mbd and Ubc gaica mbd recorded detection covariates (e.g., weather, noise) systematically. Within each farm, point counts were generally separated by 100 - 150 meters to ensure independence (but there were exceptions). Note that excluding CIPAV, all data collectors recorded whether observations were flyovers (i.e., they did not use the habitat). Please see the 'Birds_SSP_Colombia_Detailed_methodologies' document for a more detailed accounting of the methods utilized by each data collector.

    The Piedemonte ecoregion had the most comprehensive sampling, with about half of the total point count locations (n = `r Pc_piedemonte`) sampled there. All other ecoregions were surveyed at `r min(Ecor_pc_no_pdm$n)` – `r max(Ecor_pc_no_pdm$n)` unique locations.\

![Each data set has bird information from point counts clustered within farms. Each point represents a farm and the x-axis conveys the number of unique point count locations at each farm. The colors correspond to the number of repeat surveys at each point count, rounded to the nearest whole number. The number of distinct farms within each data set is printed to the right of each boxplot. Note that this text is to the left of the most heavily sampled farm in the 'Unillanos mbd' and 'Ubc mbd' data sets (24 point counts) for display reasons.](../Figures/Pc_per_farm_db.png){#fig-pc-farm-db}

a.  Instrumentation: Description and model/serial numbers\
    \
    NA\

b.  Taxonomy and systematics: References for taxonomic keys, identification, and location of voucher specimens, etc.\
    \
    We used the American Ornithologists’ Society–South American Classiﬁcation Committee (AOS–SACC) taxonomy\

c.  Permit history: References to pertinent scientific and collecting permits\
    NA\

d.  Legal/organizational requirements: Relevant laws, decision criteria, compliance standards, etc.\
    NA

### Project personnel:

Principal and associated investigator(s), technicians, supervisors, students

NA \[It seems like this would be the authors list + the people mentioned in the acknowledgements, so I'm not sure what they're looking for\]

# Class III. Data set status and accessibility

## A. Status

### Latest update:

Date of last modification of data set

```{r}
Sys.Date()
```

### Latest archive date

Date of last data set archival

TBD

### Metadata status

Date of last metadata update and current status

Last updated on `r Sys.Date()`, version submitted

### Data verification

Status of data quality assurance checking

\[ECOTROPICO\] - In collaboration with the data collectors, AAS, AH, and JH took extensive quality-control checks. Primarily, this consisted of cross-checking data collected in the field against the stated methodologies from each data set (see 'Birds_SSP_Colombia_Detailed_methodologies' file). For example, we confirmed the empirical sampling dates and times against the reported point count schedules. Additional quality assurance procedures included:

-   Taxonomy - Species names were compared against the Fernando Ayerbe’s 2018 fieldguide [@ayerbe2018guia].

-   Distributions - Species observations were compared against distributional ranges [@velezDistributionBirdsColombia2021] and elevational ranges [@quinteroGlobalElevationalDiversity2018; @freemanInterspecificCompetitionLimits2022].

-   Geospatial - Point count coordinates were verified to ensure that 1) the coordinates aligned with the reported department, 2) the proximity of point counts within an `Id_group` was reasonable (\< 2 km), and that 3) minimum point count spacing was consistent with that specified in the methodology.

-   Habitat verification - Descriptive habitat types were standardized and cross-referenced with Google Earth imagery to confirm correspondence; discrepancies within \<50 m were considered acceptable given potential GPS error \[To do - Indicate inconsistencies in the Excel somehow\]

With the help of data collectors, AAS standardized the taxonomy according to the AOS–SACC (see 'Taxonomy.csv'). The location of species observed during point counts were then compared to species distribution shapefiles that contained 1890 species (\~97% of species in Colombia) to identify potential erroneous misidentifications [@velezDistributionBirdsColombia2021]. Given the strong influence that topography has on species distributions in Colombia, we also compared species' observed elevations to elevational ranges reported in [@quinteroGlobalElevationalDiversity2018; @freemanInterspecificCompetitionLimits2022], using data from Colombia or other Andean countries where possible. All species observed outside of the species distributional range, or at an elevation \>150 meters above or below the elevational range found in the literature, were sent to the original data collector for review. Data collectors made recommendations for each species in question, falling into three categories: 1) the species identification and spatial information was correct (suggesting a range expansion), 2) the species was misidentified or wrongly transcribed and should be changed to a different species, or 3) if uncertain, the species should be removed from the database.

CMK - NOTE:: CIPAV never did this exercise, and GAICA did not finish despite it being in their most recent 2024 contract (which TNC paid for). GAICA is no longer responding to my emails.

## B. Accessibility

### Storage location and medium

Pointers to where data reside (including archival required by the ESA Open Research policy and redundant archival sites)

At present data are stored on TNC Box [here](https://tnc.box.com/s/f9b6y85ewb7a5tp630cpou0okk1s9f3s).

### Contact persons

Name, address, email

Aaron Skinner, 6201 Cecil Green Park Rd, Vancouver, BC, Canada V6T1Z1, skinnerayayron93\@gmail.com

### Copyright restrictions

Whether copyright restrictions prohibit use of all or portions of the data set

None

### Proprietary restrictions

Any other restrictions that may prevent use of all or portions of data set

Please cite this dataset (DOI TBD) when using these data.

#### a. Release date

Date when proprietary restrictions expire

CMK - I asked editors and we cannot set an embargo date, however I could postpone submission. I imagine I'm still a 8-12 months from publishing anything using these data, do you think we should hold off on submitting this for now?

#### b. Citation

How data may be appropriately cited

TBD

#### c. Disclaimer(s)

Any disclaimers that should be acknowledged by secondary users

NA

### 5. Costs

Costs associated with acquiring data (may vary by size of data request, desired medium, etc.)

None

# Class IV. Data structural descriptors

## A. Data set file

### Identity

Unique file names or codes

### Size

Number of records, record length, total number of bytes, etc.

### Format and storage mode

File type (e.g., ASCII, binary, etc.), compression schemes employed (if any), etc.

Tabular data and code is stored as .csv files and .R files, respectively.

### Header information

Description of any header data or information attached to file \[Note: may include elements related to variable information (IV.B.); if so, could be linked to appropriate section(s)\]

### Alphanumeric attributes

Mixed, upper, or lower case

### Special characters/fields:

To do - Methods used to denote comments, flag modified or questionable data, etc.

Particularly relevant for the species out of range that were not checked by the data collector

### Authentication procedures

Digital signature, checksum, actual subset(s) of data, and other techniques for assuring accurate transmission of data to secondary users

HOW DIFFERENT THAN 'DATA VERIFICATION' SECTION?

## B. Variable information

### Variable identity

Unique variable name or code

### Variable definition

Precise definition of variables in data set

### Units of measurement

Units of measurement associated with each variable

### Data type

Data files can be joined together by join keys (i.e., columns), according to the needs of the analyst (see 'Data_exploration_joins.R'). The `Bird_abundances` and `Event_covs` data sets have the join keys `Id_muestreo` and `Id_muestreo_no_dc`. The `Site_covs` data set has the join key `Id_muestreo_no_dc`. The `Bird_pcs_all`, `Taxonomy`, and `Functional_traits` data sets all share the join key `Species_ayerbe`.

For each dataset, we provide column definitions and associated metadata. For brevity, we do not provide definitions for the `Bird_pcs_analysis` data set because it is just a subset of `Bird_pcs_all`. Specifically, `Bird_pcs_analysis` only contains the species observed within the fixed point count radius and that used the habitat (i.e., not a flyover; see 'Data_filtering_analysis.R'). Similarly, definitions of the join keys (`Field_names`) are only shown in the first table they appear and are not repeated in subsequent tables. Any omitted columns are noted in the table caption. Please see the 'Column_definitions_final.xlsx', particularly the 'Column_content_definition' column, for additional information about variables. Within the .csv files, missing values are shown as blank cells `" "`.

```{r}
#| label: Print-table-fn
 
# Print table function 
Print_tbl <- function(df, join_df = NULL, remove_field = NULL){
  if(!is.null(join_df)){ 
    df <- df %>% left_join(join_df)
  }
  
  if(!is.null(remove_field)){
    df <- df %>% filter(!Field_name %in% {{ remove_field }})
  }

  df %>% relocate(Definition, .after = Field_name) %>%
    rename_with(.fn = ~str_replace(., "_", " ")) %>% 
    kable("latex", booktabs = TRUE, longtable = TRUE, escape = TRUE) %>%
    kable_styling(latex_options = c("striped", "hold_position"), 
                  position = "center") %>%
    column_spec(2, width = "5cm")
}
```

```{r}
#| label: Load-defs

path <- "Data_paper/Column_definitions_final.xlsx"
Sheet_names <- excel_sheets(path)
Covs_defs <- map(excel_sheets(path), \(sheet){
  read_excel(path = path, sheet = sheet) %>% select(-Column_content_definition)
})
names(Covs_defs) <- Sheet_names

# Bring in metadata list
Cols_metadata_l <- readRDS("Data_paper/Rdata/Cols_metadata_l.rds")
```

```{r}
#| label: tbl-bird-abundances-meta
#| tbl-cap: Metadata associated with the principal Bird point counts ('Bird_pcs_all.csv') dataset, including the identifying information of the point count.


Print_tbl(df = Cols_metadata_l$Bird_abu, join_df = Covs_defs$Bird_abundances)
```

```{r}
#| label: tbl-site-covs-meta
#| tbl-cap: Metadata associated with the 'Site_covs.csv' dataset, i.e. site-specific covariates (e.g., Elevation) that do not change across surveys. The definition for 'Id_muestreo_no_dc' is not provided. 


Print_tbl(df = Cols_metadata_l$Site_covs, join_df = Covs_defs$Site_covs, 
          remove_field = "Id_muestreo_no_dc")
```

```{r}
#| label: tbl-event-covs-meta
#| tbl-cap: Metadata associated with the 'Event_covs.csv' dataset, i.e. covariates related to the timing of the survey (e.g., date) or survey-specific covariates that can change across surveys (e.g., weather). The definitions for 'Id_muestreo', 'Id_muestreo_no_dc', 'Fecha', and 'Pc_start' are not provided.


Print_tbl(df = Cols_metadata_l$Event_covs, join_df = Covs_defs$Event_covs,
          remove_field = c("Id_muestreo", "Id_muestreo_no_dc", "Fecha", 'Pc_start'))
```

```{r}
#| label: tbl-taxonomy-meta
#| tbl-cap: Metadata associated with the 'Taxonomy.csv' dataset. The definition for 'Species_ayerbe' is not provided. 


Print_tbl(df = Cols_metadata_l$Taxonomy, join_df = Covs_defs$Taxonomy,
          remove_field = "Species_ayerbe")
```

```{r}
#| label: tbl-functional-traits-meta
#| tbl-cap: Metadata associated with the 'Functional_traits.csv' dataset. Please reference the 'Metadata' tab in the 'AVONET3_BirdTree.xlsx' (provided by Tobias et al, 2022), for definitions of fields from that source. The definition for 'Species_ayerbe' is not provided.

Print_tbl(df = Cols_metadata_l$Functional_traits, 
          join_df = Covs_defs$Functional_traits,
          remove_field = "Species_ayerbe") 
```

### Data format

#### a. Fixed, variable length

#### b. Columns

Start column, end column

#### c. Optional number of decimal places

## C. Data anomalies:

Description of missing data, anomalous data, calibration errors, etc.

Given the diverse set of data collectors and a lack of a standardized set of methodologies. CIPAV point count start time.

# Class V. Supplemental descriptors

## A. Data acquisition

### 1. Data forms or acquisition methods

Description or examples of data forms, automated data loggers, digitizing procedures, etc.

### 2. Location of completed data forms

### 3. Data entry verification procedures

## B. Quality assurance/quality control procedures

Identification and treatment of outliers, description of quality assessments, calibration of reference standards, equipment performance results, etc.

No data were altered or omitted to address outliers in `Bird_pcs_all.csv`, but there are some observations with high abundances (e.g., 4 records with \>50 individuals) that could bias analyses if not addressed. In `Bird_pcs_analysis.csv` these 4 records are removed (see X R script for more details).

## C. Related materials:

References and locations of maps, photographs, videos, GIS data layers, physical specimens, field notebooks, comments, etc.

## D. Computer programs and data-processing algorithms:

Description or listing of any algorithms used in deriving, processing, or transforming data

Full code can be found at \[GITHUB REPOSITORY\]

## E. Archiving

### 1. Archival procedures

Description of how data are archived for long-term storage and access

The original datasets can be accessed from the ECOLOGY repository.

### 2. Redundant archival sites: Locations and procedures followed

## F. Publications and results

Electronic reprints, lists of publications resulting from or related to the study, graphical/statistical data representations, etc.

```{r}
#| label: Tax-row-summary
#| tbl-cap: The number of families, genera, and species found within each order. Orders are listed by ascending diversity of families, genera, and then species. 

Tax_summary <- read_csv("Derived/Excels/Tax_summary.csv")

Total_row <- Tax_summary %>%
  summarise(across(where(is.numeric), sum, na.rm = TRUE)) %>% 
  mutate(Order = "Total") %>% 
  relocate(Order, .before = N_fam)

Tax_summary %>%
  bind_rows(Total_row) %>% 
  rename_with(~c("Order", "Families", "Genera", "Species")) %>%
  kable(booktabs = TRUE, format = "latex", longtable = TRUE) %>%
  kable_styling(latex_options = c("striped", "hold_position")) %>%
  row_spec(nrow(Tax_summary), hline_after = TRUE) %>%
  row_spec(nrow(Tax_summary) + 1, bold = TRUE)

```

## G. History of data set usage

### 1. Data request history

Log of who requested data, for what purpose, and how data set was actually used

### 2. Data set update history

Description of any updates performed on data set

### 3. Review history

Last entry, last researcher review, etc.

### 4. Questions and comments from secondary users

Questionable or unusual data discovered by secondary users; limitations or problems encountered in specific applications of data; unresolved questions or comments

# Acknowledgements

I am grateful to Camila Gómez, Nick Bayly, and several students at the Universidad de los Llanos (particularly Evelyn Alvarez and Maira Holguín Ruiz) for help with field planning in 2022, as well as everyone who facilitated logistics and access to farms, especially Yadi Lorena Duarte Cañas.

# Questions - collaborators

-   All co-authors:

    -   The 5 'ecoregions'
        -   It seems like 'Boyacá & Santander' isn't really an 'ecoregion' in the way that the others are. For example, Bajo Magdalena refers to part of a river valley, valle de rio cesar defines a river valley, whereas Boyacá & Santander are geopolitical departments. Should we change to something defined by topography? I think 'cordillera oriental' wouldn't be specific enough, but something along those lines?
        -   To a lesser extent, the 'Ecoregion cafetera' seems similar given that this name comes from the predominant crop (agricultural) / cultural similarities. This ecoregion is also 3x larger than the next largest ecoregion and covers \~3100 m of altitude, including points in both the Cauca and Magdalena river valleys as well as the cordillera central. Consider breaking up into smaller ecoregions?
        -   Should we change the 'Piedemonte' to 'Piedemonte llanero' to be more specific?
    -   Can folks provide their best guesses generally (I'm sure it varies by region) regarding the history of forest fragments and riparian forests in these landscapes? I remember there was a law implemented requiring a vegetative buffer to be left around waterways? Was this law national? When was it implemented? How big is the vegetative buffer ?
    -   I have elected to have multiple data sets with 'join keys' (i.e. the columns that are repeated in multiple data sets to allow joining of different data) to connect them, instead of 1-2 datasets with more columns and row repetition. I think this structure is helpful as it makes the data structure more explicit (e.g., there are 496 unique sites, there are 2,691 unique point count surveys). Was structuring the data this way intuitive for you?
    -   Column names: Decide whether English or Spanish
    -   Are there additional columns that you feel are important to include in this dataset?

# References {.unnumbered}
